# 质谱成像引擎渲染参数调整

<!-- 2023-05-25 -->

## 后期效果着色器

启用后期效果着色器渲染流程可以极大地提升质谱成像的渲染质量，在MZkit桌面工作站软件之中，默认开启了相关的工作流程选项，后期效果着色器的处理内容主要包括有：

1. 噪声像素点的去除
2. 成像图的平滑处理
3. 成像图亮度的动态调整
4. 图像缺失值计算

在下面的两幅图中展示了在同一个原始数据的基础上，在打开后期效果着色器以及关闭状态下，针对同一个代谢物离子的质谱成像可视化的渲染效果差异对比：


## 亮度调整

因为离子在整张切片范围内的电离化程度或者不同代谢物因为不同adducts的原因产生相同的m/z值的时候，因为不同代谢物的电离化能力的差异，导致某一个m/z离子所对应的某一个图层的离子响应度的最大值和50%中位数之间的异常差异，最终引起整张切片的灰度映射异常产生的亮度值过低。针对这种情况，在MZKit软件之中，针对质谱成像图的亮度自适应调整可以通过TrIQ算法对当前离子图层的最大响应度值的动态剪裁来完成的。

在左侧的参数调整栏之中，可以设置TrIQ参数值来完成上面所描述的最大信号值动态剪裁操作。TrIQ参数值可以调整的范围在``[0, 1]``之间。当TrIQ参数值等于1的时候，表示不进行动态剪裁操作，即禁用TrIQ算法。当TrIQ参数值越低，则当前的离子图层的信号响应值的极差会越小，整个图像的亮度越高；反之TrIQ参数值逐渐增大的时候，随着信号极值的扩大，整张切片的质谱成像渲染的亮度将会随之降低。